<!doctype html>
<html>
  <head>
    
  </head>
  <body>
    <div class="scripts" style="display: none;">
      <canvas width="300" height="100"></canvas>
      <script src="http://connect.soundcloud.com/sdk.js"></script>
      <script src="./third-party/jquery.js"></script>
      <script src="./third-party/underscore.js"></script>
      <script src="./third-party/tween.js"></script>
      <script src="./third-party/stats.js"></script>
      <script src="./third-party/two.js"></script>
      <script src="./src/trigger.js"></script>
      <script>

        var TRACK = '48079700';
        var SOUND, DEBUG = true;
        var COLORS = {
          backdrop: 'rgb(181, 181, 181)',
          background: '#555',
          middleground: 'rgb(141, 164, 170)',
          foreground: 'rgb(227, 79, 12)',
          accent: 'rgb(163, 141, 116)',
          highlight: 'rgb(255, 197, 215)',
          white: 'white',
          black: '#000'
        };

        document.body.style.background = COLORS.backdrop;

        var trigger = new Trigger();
        var canvas, ctx, stats;

        if (DEBUG) {
          stats = new Stats();
          _.extend(stats.domElement.style, {
            position: 'fixed',
            top: 0,
            left: 0
          });
          document.body.appendChild(stats.domElement);
          canvas = document.createElement('canvas');
          canvas.width = 300;
          canvas.height = 100;
          _.extend(canvas.style, {
            position: 'fixed',
            top: 0,
            right: 0,
            background: 'white'
          });
          ctx = canvas.getContext('2d');
          document.body.appendChild(canvas);
        }

        var two = new Two({
          fullscreen: true
        }).appendTo(document.body);

        SC.initialize({
          client_id: 'f362eb7eaa0b6c159e1148e127a78b88'
        });

        SC.stream('/tracks/48079700', {
          useEQData: true,
          whileplaying: analyzeWaveform
        }, function(soundObject) {
          console.log('loaded');
          SOUND = soundObject;
          SOUND.play();
        });

        function analyzeWaveform() {

          trigger.check(SOUND.eqData);

          if (!DEBUG) {
            return;
          }

          ctx.clearRect(0, 0, canvas.width, canvas.height);
          var l = SOUND.eqData.length;

          _.each(SOUND.eqData, function(v, i) {
            var pct = i / l;
            var a = SOUND.eqData[i];
            var x = pct * canvas.width;
            ctx.fillRect(x, canvas.height - canvas.height * a, 1, canvas.height * a);
          });

        }

        // Animation Loop

        (function() {

          if (DEBUG) {
            stats.update();
          }

          TWEEN.update();
          requestAnimationFrame(arguments.callee);

        })();

      </script>
      <!-- Add Triggers -->
      <script src="./src/wipe.js"></script>
      <script src="./src/polygon.js"></script>
      <script src="./src/timer.js"></script>
      <script src="./src/pinwheel.js"></script>
    </div>
  </body>
</html>