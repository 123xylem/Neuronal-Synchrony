<!doctype html>
<html>
  <head>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <link rel="stylesheet" media="screen" type="text/css" href="./styles/main.css" />
    <link rel="icon" type="image/png" href="./images/favicon.png" />
  </head>
  <body>
    <div id="loader" style="display: none;"></div>
    <div class="scripts" style="display: none;">
      <script src="./third-party/jquery.js"></script>
      <script src="./third-party/tween.js"></script>
      <script src="./third-party/two.js"></script>
      <script src="./src/animations.js"></script>
      <script src="/socket.io/socket.io.js"></script>
      <script>

        var socket = io.connect('http://localhost');
        socket
          .on('connected', function(name) {
            console.log('connected to', name);
          })
          .on('press', function (data) {

            var index = data.x;
            var on = !!data.s;
            var isColor = data.y == 7;

            if (on) {
              var o = animations.map[data.x + ',' + data.y];
              if (o && !o.playing()) {
                socket.emit('start', data);
                o.start(function() {
                  if (isColor) {
                    _.each(_.range(16), function(i) {
                      socket.emit('end', {
                        x: i,
                        y: 7
                      });
                    });
                  } else {
                    socket.emit('end', data);
                  }
                });
              }
            }

          });

        two
          .bind('update', function() {
            animations.update();
            TWEEN.update();
          }).play();

      </script>
    </div>
  </body>
</html>